# cluster_5

This module provides a workflow for analyzing and clustering gene-level phenotypic data. Unlike previous modules that use Snakemake workflows, this step consists of a single Python script that performs comprehensive analysis including feature selection, dimensionality reduction, and clustering.

## Contents

1. `cluster_5.py`: Main Python script for performing the complete clustering analysis workflow

## Usage

1. `cluster_5.py`: Run the clustering analysis.

## Key Features

- Generates paired feature plots for visual analysis
- Generates final matrices, per-perturbation of:
  - Percent of mitotic cells
  - Cleaned features (removing low number genes and missing features)
  - Ranked features (high to low)
- Performs feature selection based on:
  - Correlation analysis
  - Variance thresholding
  - Minimum unique value requirements
- Normalizes features relative to controls
- Creates hierarchical clustering visualizations
- Conducts dimensionality reduction using:
  - PCA (Principal Component Analysis)
  - PHATE (Potential of Heat-diffusion for Affinity-based Trajectory Embedding)
- Implements Leiden clustering for population identification
- Produces comprehensive visualizations including:
  - Feature correlation plots
  - Cell count histograms
  - Hierarchical clustering heatmaps
  - PCA variance plots
  - PHATE embeddings

## Dependencies

- Python libraries: pandas, numpy, scipy, sklearn
- ops package modules:
  - ops.cluster: For clustering and analysis functions
  - ops.plotting: For visualization utilities
- Additional libraries:
  - phate: For dimensionality reduction
  - leidenalg: For community detection

## File Structure

```
plate/
├── aggregate_4/
│   └── csv/
│       ├── all_gene_data.csv
│       ├── mitotic_gene_data.csv
│       └── interphase_gene_data.csv
└── cluster_5/
    ├── cluster_5.py
    ├── cluster_5.sh
    ├── csv/*
    └── plots/*
```

Directories marked with an asterisk contain files generated by this workflow.

Note:
- Ensure that your input files from the aggregate_4 step are present in `aggregate_4/csv` before running the script
- The workflow generates:
  - Processed and analyzed data in `cluster_5/csv/`
  - Visualization plots in `cluster_5/plots/`

Maintaining this file structure is crucial for the correct execution of the workflow. Any changes to the structure may require corresponding adjustments in the script.